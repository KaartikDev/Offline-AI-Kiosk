{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://offline-kiosk/schemas/knowledge_pack.schema.json",
  "title": "Knowledge Pack",
  "type": "object",
  "required": ["id", "name", "version", "domain", "scope", "languages", "safety", "sources", "content_map", "compat"],
  "properties": {
    "id": { "type": "string", "pattern": "^[a-z0-9-]{3,64}$", "description": "Stable slug" },
    "name": { "type": "string", "minLength": 3 },
    "version": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-z0-9.]+)?$" },
    "description": { "type": "string" },
    "domain": { "enum": ["home_maintenance", "first_aid", "education_career", "disaster_response", "agriculture", "custom"] },
    "scope": {
      "type": "object",
      "required": ["in_scope", "out_of_scope"],
      "properties": {
        "in_scope": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
        "out_of_scope": { "type": "array", "items": { "type": "string" } }
      }
    },
    "languages": {
      "type": "array",
      "items": { "type": "string", "pattern": "^[a-z]{2}(-[A-Z]{2})?$" },
      "minItems": 1
    },
    "reading_level": { "enum": ["pictorial", "very_simple", "simple", "standard"] },
    "interaction": {
      "type": "object",
      "properties": {
        "supports_voice": { "type": "boolean" },
        "qna_style": { "enum": ["checklist", "steps", "qa", "flowchart"] }
      }
    },
    "safety": {
      "type": "object",
      "required": ["refusals", "escalation_rules", "legal_disclaimer"],
      "properties": {
        "refusals": {
          "type": "object",
          "required": ["rules"],
          "properties": {
            "rules": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["trigger", "response"],
                "properties": {
                  "trigger": { "type": "string", "description": "Regex or plain contains" },
                  "response": { "type": "string" }
                }
              }
            },
            "mode": { "enum": ["regex", "substring"], "default": "substring" }
          }
        },
        "escalation_rules": {
          "type": "array",
          "description": "When to recommend immediate professional help",
          "items": {
            "type": "object",
            "required": ["condition", "message"],
            "properties": {
              "condition": { "type": "string", "description": "Plain text condition description" },
              "message": { "type": "string" }
            }
          }
        },
        "legal_disclaimer": { "type": "string" }
      }
    },
    "sources": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["title", "publisher", "year", "type"],
        "properties": {
          "title": { "type": "string" },
          "publisher": { "type": "string" },
          "year": { "type": "integer", "minimum": 1900, "maximum": 2100 },
          "type": { "enum": ["guideline", "textbook", "ngo_doc", "government", "original"] },
          "url": { "type": "string" },
          "pages": { "type": "string" }
        }
      }
    },
    "content_map": {
      "type": "object",
      "description": "Logical â†’ file pointers per locale",
      "patternProperties": {
        "^[a-z0-9-_./]+$": {
          "type": "object",
          "minProperties": 1,
          "additionalProperties": { "type": "string", "description": "relative path in locale/*" }
        }
      }
    },
    "compat": {
      "type": "object",
      "required": ["model_min", "app_version_min"],
      "properties": {
        "model_min": { "type": "string", "description": "e.g., gpt-oss:20b" },
        "quantization": { "type": "array", "items": { "enum": ["fp16", "int8", "int4"] } },
        "app_version_min": { "type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$" }
      }
    },
    "packaging": {
      "type": "object",
      "properties": {
        "created_utc": { "type": "string", "format": "date-time" },
        "content_bytes": { "type": "integer", "minimum": 0 },
        "sha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" }
      }
    },
    "maintainers": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": { "type": "string" },
          "email": { "type": "string" },
          "org": { "type": "string" },
          "role": { "type": "string" }
        }
      }
    },
    "audit": {
      "type": "object",
      "properties": {
        "medical_reviewer": { "type": "string" },
        "last_review_utc": { "type": "string", "format": "date-time" },
        "change_notes": { "type": "string" }
      }
    },
    "license": { "type": "string" },
    "region_tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "e.g., IN-BIH, US-GA, SA-General"
    }
  },
  "additionalProperties": false
}
